```{r}
library(dplyr)
library(readxl)
library(tidyverse)
```

```{r}
MIX<-read_xlsx("MIX_model_original_data.xlsx")
MC<-read_xlsx("MC_model_original_data.xlsx")
```

```{r Dependent Variables for MC}
#Dependent Variable: ELISA_microcystin_ugL 
#Dependent Variable: ELISA_MC+ANA+SXT
```

```{r}
MC$Year = format(as.Date(MC$DateTime, format = "%Y-%m-%d"), "%Y")
MC_new = MC[!is.na(MC$'ELISA_MC+ANA+SXT'),]
MC_clean = MC_new %>% select_if(~ !any(is.na(.)))
MC_clean$Year = format(as.Date(MC_clean$DateTime, format = "%Y-%m-%d"), "%Y")
MC_clean = MC_clean %>% group_by(Year, siteID)

MIX$Year = format(as.Date(MIX$DateTime, format = "%Y-%m-%d"), "%Y")
MIX = MIX %>% group_by(Year, siteID)
MIX_new = MIX[!is.na(MIX$'ELISA_MC+ANA+SXT'),]
MIX_clean = MIX_new %>% select_if(~ !any(is.na(.)))
MIX_clean$Year = format(as.Date(MIX_clean$DateTime, format = "%Y-%m-%d"), "%Y")

```
##Creating Table 2
The report was unclear about how they calculated the minimum, maximum, and median for each site ID by year. The report stated that their sample size was n=41 for each site ID. That means they worked with the original data collected. If we did this a lot of the statistics would come back as NAs due to a significant amount of NAs in the data collected. We decided to work with the original data but calculate the statistics without the NAs in order to produce the table. This is why our numbers don't match the table in the report.
```{r}
MC <- MC %>% group_by(Year, siteID)
Table_1 <- MC %>% summarise(max_pH=max(pH, na.rm=TRUE), min_pH=min(pH, na.rm=TRUE), median_pH=median(pH, na.rm=TRUE)) 
Table_2 <- MC %>% summarise(max_WT=max(WTemp_C, na.rm=TRUE), min_WT=min(WTemp_C, na.rm=TRUE), median_WT=median(WTemp_C, na.rm=TRUE)) 
Table_3 <- MC %>% summarise(max_D=max(Secchi_meters, na.rm=TRUE), min_D=min(Secchi_meters, na.rm=TRUE), median_D=median(Secchi_meters, na.rm=TRUE)) 
Table_4 <- MC %>% summarise(max_SC=max(SpCond_uScm, na.rm=TRUE), min_SC=min(SpCond_uScm, na.rm=TRUE), median_SC=median(SpCond_uScm, na.rm=TRUE)) 
Table_5 <- MC %>% summarise(max_NH3=max(Ammonia_mgL_LAG, na.rm=TRUE), min_NH3=min(Ammonia_mgL_LAG, na.rm=TRUE), median_NH3=median(Ammonia_mgL_LAG, na.rm=TRUE)) 
Table_6 <- MC %>% summarise(max_NN=max(Nox_mgL_LAG, na.rm=TRUE), min_NN=min(Nox_mgL_LAG, na.rm=TRUE), median_NN=median(Nox_mgL_LAG, na.rm=TRUE)) 
Table_7 <- MC %>% summarise(max_OP=max(OrthoP_mgL_LAG, na.rm=TRUE), min_OP=min(OrthoP_mgL_LAG, na.rm=TRUE), median_OP=median(OrthoP_mgL_LAG, na.rm=TRUE)) 
Table_8 <- MC %>% summarise(max_TP=max(TP_mgL_LAG, na.rm=TRUE), min_TP=min(TP_mgL_LAG, na.rm=TRUE), median_TP=median(TP_mgL_LAG, na.rm=TRUE)) 
Table_9 <- MC %>% summarise(max_TN=max(TN_mgL_LAG, na.rm=TRUE), min_TN=min(TN_mgL_LAG, na.rm=TRUE), median_TN=median(TN_mgL_LAG, na.rm=TRUE)) 
Table_10 <- MC %>% summarise(max_NiP=max(NtoP_ratio_LAG, na.rm=TRUE), min_NiP=min(NtoP_ratio_LAG, na.rm=TRUE), median_NiP=median(NtoP_ratio_LAG, na.rm=TRUE))

Table <- merge(Table_1,Table_2, by=c("siteID", "Year"))
Table <- merge(Table,Table_3, by=c("siteID", "Year"))
Table <- merge(Table,Table_4, by=c("siteID", "Year"))
Table <- merge(Table,Table_5, by=c("siteID", "Year"))
Table <- merge(Table,Table_6, by=c("siteID", "Year"))
Table <- merge(Table,Table_7, by=c("siteID", "Year"))
Table <- merge(Table,Table_8, by=c("siteID", "Year"))
Table <- merge(Table,Table_9, by=c("siteID", "Year"))
Table <- merge(Table,Table_10, by=c("siteID", "Year"))

```
##Creating Table 3

```{r}
MC_clean %>% group_by(Year, siteID) 
Table3 = MC_clean %>% summarise(min_Anatoxin=min(ELISA_anatoxin_ugL), max_Anatoxin=max(ELISA_anatoxin_ugL), med_Anatoxin=median(ELISA_anatoxin_ugL), min_Microcystin=min(ELISA_microcystin_ugL), max_Microcystin=max(ELISA_microcystin_ugL), med_Microcystin=median(ELISA_microcystin_ugL), min_Saxitoxin=min(ELISA_saxitoxin_ugL), max_Saxitoxin=max(ELISA_saxitoxin_ugL), med_Saxitoxin=median(ELISA_saxitoxin_ugL))

```

 
```{r}
#The variables that are included in Table 4 include Water temperature(WT) Specific conductance(SC), Total phosphorus(TP), "the plank one"(Plank_mcyE), "the micro one"(Micro_mcyE), Anatoxin(anaC), Saxitoxin(sxtA), Wind direction(WindDir), Lake level for 7 days(LL_7day), Lake level spring average(LL_Spring), Lake level 14 days(LL_14day)
MC_clean2 = MC_clean %>% select(-c("ELISA_anatoxin_ugL", "Ammonia_mgL_LAG", "Nox_mgL_LAG", "Nitrite_mgL_LAG", "Nitrate_mgL_LAG", "OrthoP_mgL_LAG", "SXTx100", "DateTime", "MCx12.5", "siteID", "Year", "Ana_mcyE_cp100mL_LAG", "LkLevelChg7day"))

#Ana_mcYE had 21/50 repeated values
#LkLevelChg24_Ave7day has perfect colinearity with LkLevelChg7day so took out LkLevelChg7day since its not in the final model
#took out Rain48W because it was highly correlated with Rain72W

colnames(MC_clean2)[2] = "ELISA_MC_ANA_SXT"

model1 = lm(ELISA_microcystin_ugL ~ WTemp_C + Secchi_meters + pH + SpCond_uScm + TP_mgL_LAG + TN_mgL_LAG + NtoP_ratio_LAG + Micro_mcyE_cp100mL_LAG + Plank_mcyE_cp100mL_LAG + anaC_cp100mL_LAG + sxtA_cp100mL_LAG + WindSpInst_mph + WindDirInst_deg + WindSpAnt24_mph + WindDirAnt24_deg + RainD_1 + RainD_2 + RainD_3 + Rain48W_in + Rain72W_in + Sum7d_precip + Sum14d_precip + BarPressInst_inhg + changeBP + LkLevelChg24_ft + LkLevelChg14day + LkLevelChg24_Ave7day + LkLevelChg24_Ave7dayABS + LkLevel_dev_springave + PAR_1dSUM + PAR_3dAVG + PAR_5dAVG + PAR_7dAVG + PAR_14dAVG + Dis_dm1 + Dis_dm2 + Dis_dm3 + Dis_7dAve + Dis_14dAve + Dis_30dAve, data = MC_clean2)
summary(model1)

vif(model1)

corr_matrix = cor(MC_clean2)
corrplot(corr_matrix)

cor.test(MC_clean2$Rain48W_in, MC_clean2$Dis_30dAve)

#took out Rain72 and RainD1 because of high colinearity

model2 = lm(ELISA_microcystin_ugL ~ WTemp_C + Secchi_meters + pH + SpCond_uScm + TP_mgL_LAG + NtoP_ratio_LAG + Micro_mcyE_cp100mL_LAG + Plank_mcyE_cp100mL_LAG + anaC_cp100mL_LAG + sxtA_cp100mL_LAG + WindSpInst_mph + WindDirInst_deg + WindSpAnt24_mph + WindDirAnt24_deg + Rain48W_in + Sum14d_precip + BarPressInst_inhg + changeBP + LkLevelChg14day + LkLevelChg24_Ave7day + LkLevelChg24_Ave7dayABS + LkLevel_dev_springave + PAR_1dSUM, data = MC_clean2)
summary(model2)

vif(model2)
#brings it down to like 25 variables
```

```{r}
model3_MIX = lm(ELISA_MC_ANA_SXT ~ WTemp_C + Secchi_meters + pH + SpCond_uScm + TP_mgL_LAG + NtoP_ratio_LAG + Micro_mcyE_cp100mL_LAG + Plank_mcyE_cp100mL_LAG + anaC_cp100mL_LAG + sxtA_cp100mL_LAG + WindSpInst_mph + WindDirInst_deg + WindSpAnt24_mph + WindDirAnt24_deg + RainD_1 + Sum14d_precip + BarPressInst_inhg + changeBP + LkLevelChg14day + LkLevelChg24_Ave7day + LkLevelChg24_Ave7dayABS + LkLevel_dev_springave + PAR_1dSUM, data = MC_clean2)
summary(model3_MIX)

vif(model3_MIX)

MC_clean3 = MC_clean2 %>% select("ELISA_microcystin_ugL", "WTemp_C", "Secchi_meters", "pH", "SpCond_uScm", "TP_mgL_LAG", "NtoP_ratio_LAG", "Micro_mcyE_cp100mL_LAG", "Plank_mcyE_cp100mL_LAG", "anaC_cp100mL_LAG", "sxtA_cp100mL_LAG", "WindSpInst_mph", "WindDirInst_deg",  "WindSpAnt24_mph", "WindDirAnt24_deg", "Rain48W_in", "Sum14d_precip", "BarPressInst_inhg", "changeBP", "LkLevelChg14day",  "LkLevelChg24_Ave7day", "LkLevelChg24_Ave7dayABS", "LkLevel_dev_springave", "PAR_1dSUM")

MIX_clean4 = MC_clean2 %>% select("ELISA_MC_ANA_SXT", "WTemp_C", "Secchi_meters", "pH", "SpCond_uScm", "TP_mgL_LAG", "NtoP_ratio_LAG", "Micro_mcyE_cp100mL_LAG", "Plank_mcyE_cp100mL_LAG", "anaC_cp100mL_LAG", "sxtA_cp100mL_LAG", "WindSpInst_mph", "WindDirInst_deg", "WindSpAnt24_mph", "WindDirAnt24_deg", "RainD_1", "Sum14d_precip", "BarPressInst_inhg", "changeBP", "LkLevelChg14day", "LkLevelChg24_Ave7day", "LkLevelChg24_Ave7dayABS", "LkLevel_dev_springave", "PAR_1dSUM")
```
